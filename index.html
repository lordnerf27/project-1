<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Final Quiz</title>
<link href="https://fonts.googleapis.com/css2?family=VT323&family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
  *{box-sizing:border-box}
  html,body{height:100%;margin:0}
  :root{
    --bg-pale:#ffd9e6; --ink:#231f20; --white:#fff;

    /* Base (pre-pick & Player 1 baseline) */
    --frame-top:#ffe6f1; --frame-bot:#ffd1e4; --frame-border:#ffc3da; --gif-opacity:.18;
    --dialog-bg:#b68aa5d0; --dialog-border:#ffc3da; --dialog-fg:#ffffff;
    --title-color:#000;
  }
  body{
    font-family:'VT323',ui-monospace,monospace;
    color:var(--ink); background:var(--bg-pale);
    display:grid; place-items:center; overflow:hidden;
  }
  /* Global background (single image, full cover) */
  body::before{
    content:""; position:fixed; inset:-6vmax;
    background:url('assets/output.png') center/cover no-repeat; z-index:-1;
  }

  .frame{
    width:min(95vw,1200px); aspect-ratio:16/9;
    border-radius:22px; border:10px solid var(--white);
    box-shadow:0 28px 60px rgba(0,0,0,.25), inset 0 0 0 6px var(--frame-border);
    position:relative; overflow:hidden;
    background:linear-gradient(to bottom,var(--frame-top),var(--frame-bot));
    transition:background .8s ease-in-out, box-shadow .8s ease-in-out, color .2s ease-in-out;
  }
  /* Looping GIF overlay inside frame */
  .frame::after{
    content:""; position:absolute; inset:0;
    background:url('assets/frame-bg.gif') center/50% auto no-repeat;
    opacity:var(--gif-opacity); pointer-events:none;
  }

  /* Player 1 explicit theme (visible change) */
  .theme-player1{
    --ink:#231f20;
    --frame-top:#ffeaf4; --frame-bot:#ffcade; --frame-border:#ff9fcf; --gif-opacity:.22;
    --dialog-bg:#c999b1d0; --dialog-border:#ff9fcf; --dialog-fg:#ffffff;
    --title-color:#4b2f3a;
  }
  /* Player 2 dim/dark + neon “destination” */
  .theme-player2{
    --ink:#f3f6fa;
    --frame-top:#2a0b0f; --frame-bot:#090406; --frame-border:#111; --gif-opacity:.30;
    --dialog-bg:#141414c0; --dialog-border:#111; --dialog-fg:#ffffff;
    --title-color:#b56bff;
  }
  .theme-player2 .top-title{ color:var(--title-color); text-shadow:0 0 6px #b56bff,0 0 10px #b56bff; }
  .theme-player2 .option{ background:#000; color:#fff; border-color:#fff; text-shadow:0 0 3px #fff,0 0 6px #fff; }
  .theme-player2 .card,.theme-player2 .btn,.theme-player2 .player{ border-color:#111; }
  .theme-player2 .badge{ border-color:#111; }

  /* Sliding doors */
  .door{
    position:absolute; top:0; bottom:0; width:55%; z-index:4;
    background:
      linear-gradient(180deg, rgba(255,255,255,.35), rgba(255,255,255,.08)),
      repeating-linear-gradient(90deg, rgba(0,0,0,.05) 0 8px, transparent 8px 20px);
    background-color:#ffb3cd;
    box-shadow:inset 0 0 0 5px rgba(255,255,255,.5), 0 10px 28px rgba(0,0,0,.18);
    transition:transform 1100ms cubic-bezier(.22,.9,.22,1);
  }
  .door.left{left:0; transform:translateX(0)}
  .door.right{right:0; transform:translateX(0)}
  .frame.open .door.left{transform:translateX(-100%)}
  .frame.open .door.right{transform:translateX(100%)}

  .content{position:absolute; inset:0; display:grid; place-items:center; padding:20px; z-index:6}
  .panel{width:100%; max-width:960px; position:relative}

  h1{font:700 36px 'Press Start 2P', monospace; letter-spacing:1px; margin:0 0 8px; text-shadow:0 2px 0 #fff8}
  h2{font:700 28px 'Press Start 2P', monospace; letter-spacing:1px; margin:0 0 8px; text-shadow:0 2px 0 #fff8}
  p{margin:0}

  .card{
    background:#fff6; border:4px solid var(--frame-border); border-radius:14px;
    padding:18px 22px; text-align:center; box-shadow:0 8px 0 rgba(0,0,0,.12);
    backdrop-filter: blur(1px);
  }
  .btn{
    cursor:pointer; margin-top:12px; padding:12px 18px; background:#fff;
    border:3px solid var(--frame-border); border-radius:10px;
    box-shadow:0 4px 0 rgba(0,0,0,.12);
    font:700 18px 'Press Start 2P', monospace;
  }
  .btn:active{transform:translateY(2px); box-shadow:0 2px 0 rgba(0,0,0,.12)}

  .players{display:flex;gap:18px;justify-content:center;flex-wrap:wrap;margin-top:14px}
  .player{
    width:190px; aspect-ratio:3/4; border-radius:14px; overflow:hidden;
    border:4px solid var(--frame-border); background:#fff; cursor:pointer;
    box-shadow:0 6px 0 rgba(0,0,0,.12); transition:transform .12s ease
  }
  .player:hover{transform:translateY(-3px)}
  .player img{width:100%;height:100%;object-fit:cover;object-position:center}

  .top-title{
    position:absolute; left:0; right:0; top:18px; text-align:center;
    font:700 26px 'Press Start 2P', monospace; color:var(--title-color);
    transition: opacity .5s ease;
  }
  .grid{ margin-top:172px; display:grid; grid-template-columns:repeat(2,1fr); gap:16px; transition: opacity .5s ease }
  .option{
    padding:14px 16px; font-size:26px; text-align:center; background:#fff;
    border:4px solid var(--frame-border); border-radius:12px;
    box-shadow:0 5px 0 rgba(0,0,0,.12); cursor:pointer
  }
  .option:active{transform:translateY(2px); box-shadow:0 3px 0 rgba(0,0,0,.12)}
  .faded{ opacity:0; pointer-events:none; }

  .dialog{
    position:absolute; left:16px; right:16px; bottom:16px; z-index:7;
    background:var(--dialog-bg); border:3px solid var(--dialog-border); border-radius:12px;
    padding:10px 14px; display:flex; align-items:center; gap:10px;
    color:var(--dialog-fg); text-shadow:0 1px 0 #0006; font-size:24px
  }
  .dialog img{width:36px;height:36px;object-fit:cover;border-radius:8px;border:2px solid var(--dialog-border)}

  .floatCard{
    position:absolute; left:50%; top:50%; width:320px; height:360px;
    transform:translate(-50%,-50%); border-radius:14px; overflow:hidden;
    border:4px solid var(--frame-border); display:none; z-index:10; background:#000;
    box-shadow:0 8px 30px rgba(0,0,0,.25)
  }
  .floatCard img{width:100%;height:100%;object-fit:contain;object-position:center}

  canvas#fx{position:absolute; inset:0; z-index:11; pointer-events:none}

  .badge{
    position:absolute; top:12px; left:12px; z-index:8;
    width:64px; height:64px; border:3px solid var(--frame-border); border-radius:10px;
    background:#fff; overflow:hidden; display:none; image-rendering:pixelated;
  }
  .badge img{width:100%;height:100%;object-fit:cover}

  .success-title{
    position:absolute; left:0; right:0; top:22px; text-align:center;
    font:700 28px 'Press Start 2P', monospace; color:#fff;
    text-shadow:0 2px 0 #000, 0 0 8px #ff79a8;
    z-index:9; display:none;
  }

  .hide{display:none}
</style>
</head>
<body>
  <div class="frame" id="frame">
    <canvas id="fx"></canvas>

    <div class="door left"></div>
    <div class="door right"></div>

    <div class="content" id="screen">
      <div class="panel" id="startPane">
        <div class="card" style="max-width:760px;margin-inline:auto">
          <h1>WELCOME</h1>
          <p style="font:700 16px 'Press Start 2P', monospace;opacity:.85">Click to start</p>
          <button class="btn" id="startBtn">START</button>
        </div>
      </div>

      <div class="panel hide" id="playerPane">
        <div class="card">
          <h2>Pick your player</h2>
          <div class="players">
            <button class="player" data-src="assets/player-profile.jpg" data-theme="player1" title="PlayerProfile">
              <img src="assets/player-profile.jpg" alt="Player 1">
            </button>
            <button class="player" data-src="assets/player-profile-2.jpg" data-theme="player2" title="PlayerProfile2">
              <img src="assets/player-profile-2.jpg" alt="Player 2">
            </button>
          </div>
        </div>
      </div>

      <div class="panel hide" id="quizPane">
        <div class="top-title" id="titleTop">Choose your destination!</div>
        <div class="grid" id="optionsGrid">
          <button class="option" data-key="IUB">IUB</button>
          <button class="option" data-key="NSU">NSU</button>
          <button class="option" data-key="AIUB">AIUB</button>
          <button class="option" data-key="BRAC">BRAC</button>
        </div>
      </div>

      <div class="floatCard" id="floatCard"><img id="floatImg" src="" alt=""></div>
      <div class="badge" id="playerBadge"><img id="badgeImg" src="" alt=""></div>
      <div class="success-title" id="successTitle">CONGRATULATIONS!</div>
    </div>

    <div class="dialog" id="dialog">
      <img src="assets/avatar.jpg" alt="avatar">
      <div id="dialogText">Click START to begin.</div>
    </div>
  </div>

<script>
/* ---------- Helpers ---------- */
const $  = s => document.querySelector(s);
const $$ = s => document.querySelectorAll(s);

/* Typewriter with cancel */
const Typewriter = (function(){
  let timer = null;
  function stop(){ if(timer){ clearInterval(timer); timer=null; } }
  async function type(el, text, speed=22){
    stop(); el.textContent='';
    return new Promise(res=>{
      let i=0;
      timer=setInterval(()=>{ el.textContent+=text[i++]||''; if(i>text.length){stop();res();}},speed);
    });
  }
  async function backspace(el, totalMs=3000){
    stop();
    const full = el.textContent || ''; let i=full.length;
    if(!i) return;
    const step=Math.max(12, Math.floor(totalMs/Math.max(1,full.length)));
    return new Promise(res=>{
      timer=setInterval(()=>{ el.textContent=full.slice(0,--i); if(i<=0){stop();res();}},step);
    });
  }
  return { type, backspace, stop };
})();

/* Gentle float (slow, non-erratic) */
let floatRAF, floatT=0;
function startFloat(el){
  cancelAnimationFrame(floatRAF);
  const amp=8, spd=0.0006;
  let last=performance.now();
  function loop(now){
    const dt=Math.min(32, now-last); last=now;
    floatT += spd*dt;
    const dx=Math.sin(floatT*2)*amp, dy=Math.cos(floatT*1.6)*amp;
    el.style.transform=`translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px))`;
    floatRAF=requestAnimationFrame(loop);
  }
  floatRAF=requestAnimationFrame(loop);
}

/* FX module — DPI aware + continuous confetti rain */
const Fx=(function(){
  const c=$('#fx'), ctx=c.getContext('2d');
  let cssW=0, cssH=0, dpr=1, parts=[], raf, rainTimer=null;

  function doResize(){
    const rect=c.getBoundingClientRect();
    dpr = window.devicePixelRatio || 1;
    cssW = rect.width; cssH = rect.height;
    c.width  = Math.round(cssW * dpr);
    c.height = Math.round(cssH * dpr);
    c.style.width  = cssW + 'px';
    c.style.height = cssH + 'px';
    ctx.setTransform(dpr,0,0,dpr,0,0); // draw in CSS pixels
  }
  if('ResizeObserver' in window){
    const ro = new ResizeObserver(doResize);
    ro.observe(c);
  }
  window.addEventListener('resize', doResize);
  doResize();

  function push(p){ parts.push(p); if(!raf) loop(); }

  function burst(x,y,color='#ffec00',count=120){
    for(let i=0;i<count;i++){
      const a=Math.random()*Math.PI*2, v=1+Math.random()*3;
      push({x,y,vx:Math.cos(a)*v,vy:Math.sin(a)*v,life:60+Math.random()*40,age:0,color,size:3,grav:0.03});
    }
  }

  function confettiRain(rows=7, perRow=36){
    for(let r=0;r<rows;r++){
      const y = -10 - r*14;
      for(let i=0;i<perRow;i++){
        const x = (i+Math.random())/perRow * cssW;  // full current width
        const v = 1.5 + Math.random()*1.5;
        const col = (i%3===0)?'#ff79a8':(i%3===1)?'#ffffff':'#ffd400';
        push({x,y,vx:(Math.random()-.5)*0.6,vy:v,life:120+Math.random()*40,age:0,color:col,size:3,grav:0.01});
      }
    }
  }

  function startConfettiRain({piecesPerSecond=600, colors=['#ff79a8','#ffffff','#ffd400']}={}){
    if(rainTimer) return;
    const batch = Math.max(1, Math.round(piecesPerSecond/12)); // ~12 batches/sec
    rainTimer = setInterval(()=>{
      for(let i=0;i<batch;i++){
        const x = Math.random() * cssW;           // FULL width
        const y = -12 - Math.random()*20;         // just above top
        const v = 1.2 + Math.random()*2.2;
        const col = colors[i % colors.length];
        push({x,y,vx:(Math.random()-.5)*0.6,vy:v,life:120+Math.random()*40,age:0,color:col,size:3,grav:0.01});
      }
    }, 1000/12);
    if(!raf) loop();
  }
  function stopConfettiRain(){
    if(rainTimer){ clearInterval(rainTimer); rainTimer=null; }
  }

  function sparksAround(x,y,count=80){
    for(let i=0;i<count;i++){
      const a=Math.random()*Math.PI*2, v=0.6+Math.random()*1.2;
      const col = (i%2)?'#ffd400':'#ff79a8';
      push({x,y,vx:Math.cos(a)*v,vy:Math.sin(a)*v,life:40+Math.random()*20,age:0,color:col,size:2,grav:0.01});
    }
  }

  function loop(){
    raf=requestAnimationFrame(loop);
    ctx.clearRect(0,0,cssW,cssH);
    for(let i=parts.length-1;i>=0;i--){
      const p=parts[i];
      p.age++; p.x+=p.vx; p.y+=p.vy; p.vy+=p.grav||0.02;
      const a=1 - p.age/p.life;
      if(a<=0){ parts.splice(i,1); continue; }
      ctx.globalAlpha=Math.max(0,a);
      ctx.fillStyle=p.color;
      ctx.fillRect(p.x,p.y,p.size||3,p.size||3);
      ctx.globalAlpha=1;
    }
    if(parts.length===0){ cancelAnimationFrame(raf); raf=0; }
  }

  function size(){ return {w:cssW, h:cssH, canvas:c}; }

  return { burst, confettiRain, startConfettiRain, stopConfettiRain, sparksAround, size };
})();

/* ---------- App flow ---------- */
const frame=$('#frame');
const startPane=$('#startPane');
const playerPane=$('#playerPane');
const quizPane=$('#quizPane');
const titleTop=$('#titleTop');
const optionsGrid=$('#optionsGrid');

const dialog=$('#dialog');
const dialogText=$('#dialogText');

const floatCard=$('#floatCard');
const floatImg=$('#floatImg');

const badge=$('#playerBadge');
const badgeImg=$('#badgeImg');

const successTitle=$('#successTitle');

function openDoors(){ frame.classList.add('open'); }
function closeDoors(){ frame.classList.remove('open'); }

let chosenPlayerSrc=null;
let firstClicks={IUB:false,NSU:false,AIUB:false,BRAC:false};
const correctKey='IUB';

/* START -> PLAYER */
const startBtn = $('#startBtn');
startBtn.addEventListener('click', async()=>{
  openDoors();
  startPane.classList.add('hide');
  playerPane.classList.remove('hide');
  await Typewriter.type(dialogText,"Choose your aesthetic",18);
});

/* PLAYER -> QUIZ + THEME */
$$('.player').forEach(btn=>{
  btn.addEventListener('click', async()=>{
    chosenPlayerSrc=btn.dataset.src;
    const theme=btn.dataset.theme;

    frame.classList.remove('theme-player1','theme-player2');
    if(theme==='player1') frame.classList.add('theme-player1');
    if(theme==='player2') frame.classList.add('theme-player2');

    badgeImg.src=chosenPlayerSrc; badge.style.display='block';

    playerPane.classList.add('hide');
    quizPane.classList.remove('hide');
    await Typewriter.type(dialogText,"Woohoo! Where do you want to go?",18);
  });
});

/* QUIZ */
$$('.option').forEach(btn=>{
  btn.addEventListener('click', async()=>{
    const key=btn.dataset.key;
    const first=!firstClicks[key]; firstClicks[key]=true;

    if(key!==correctKey){
      let msg="";
      if(key==='NSU')  msg = first ? "You're too broke for this." : "Ah, you miss me that much.";
      if(key==='AIUB') msg = first ? "Don't go there." : "Whoa, whoa, whoa, don't go there now, come on.";
      if(key==='BRAC') msg = first ? "Whoa, I thought you were scared of presentations." : "Damn, I don't think you have the money for this.";
      await Typewriter.type(dialogText,msg,18);
      return;
    }

    if(first){
      await Typewriter.type(dialogText,"First attempt didn't work, try again!",18);
      return;
    }

    /* SUCCESS */
    badge.style.display='none';
    optionsGrid.classList.add('faded');
    titleTop.classList.add('faded');
    successTitle.style.display='block';

    if(chosenPlayerSrc){
      floatImg.src=chosenPlayerSrc;
      floatCard.style.display='block';
      startFloat(floatCard);
    }

    // Use canvas CSS size so effects fill entire frame
    const {w:W, h:H, canvas:cv} = Fx.size();

    // Fireworks at both bottom corners
    Fx.burst(15, H-20, '#ff79a8', 160);
    Fx.burst(W-15, H-20, '#ffd400', 160);

    // Continuous confetti rain for 7s across FULL width
    Fx.startConfettiRain({piecesPerSecond:700});
    setTimeout(()=>Fx.stopConfettiRain(), 7000);

    // Sparks around the floating image center (use canvas coords)
    const fc = floatCard.getBoundingClientRect();
    const cvr = cv.getBoundingClientRect();
    const cx = fc.left - cvr.left + fc.width/2;
    const cy = fc.top  - cvr.top  + fc.height/2;
    Fx.sparksAround(cx, cy, 120);

    await Typewriter.type(dialogText,"Congratulations, this is the first step to your dreams.",18);

    setTimeout(async ()=>{
      await Typewriter.backspace(dialogText,3000);
      setTimeout(()=>Typewriter.type(dialogText,"I love you",26),2000);
    },3000);
  });
});

/* Init */
closeDoors();
window.addEventListener('load', ()=>{ /* ensure canvas sizes are right on load */ });
</script>
</body>
</html>
