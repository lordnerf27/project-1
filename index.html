<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>VibeCode Retro App</title>
<link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
<style>
  *{box-sizing:border-box}
  html,body{height:100%;margin:0}
  :root{
    /* Sakura/cream pinks */
    --bg-pale:#ffd9e6;       /* page wash under the doodles */
    --frame-top:#ffe6f1;     /* inner gradient start */
    --frame-bot:#ffd1e4;     /* inner gradient end   */
    --ink:#231f20;
    --accent:#ff79a8;
    --white:#fff;
    --shadow:rgba(0,0,0,.25);
  }
  body{
    /* Global doodle background (your output.png), tiled with no gaps */
    background-color:var(--bg-pale);
    background-image:url('assets/output.png');
    background-repeat:repeat;
    background-size:720px auto; /* tile size; adjust if you want it denser/looser */
    font-family:'VT323', ui-monospace, monospace;
    color:var(--ink);
    display:grid;place-items:center;
  }

  /* ===== Game frame ===== */
  .frame{
    width:min(94vw, 1150px);
    aspect-ratio:16/9;
    border-radius:20px;
    border:10px solid var(--white);
    box-shadow:0 28px 60px var(--shadow), inset 0 0 0 6px #ffc3da;
    position:relative;
    overflow:hidden;
    background:linear-gradient(to bottom, var(--frame-top), var(--frame-bot));
  }
  /* faded, looping gif centered */
  .frame::after{
    content:"";
    position:absolute; inset:0;
    background:url('assets/frame-bg.gif') center/55% auto no-repeat;
    opacity:.18; pointer-events:none;
    mix-blend-mode:normal;
  }

  /* curtains (visible) */
  .curtain{
    position:absolute;top:0;bottom:0;width:55%;
    background:
      repeating-linear-gradient(90deg, #ff89b8 0 7px, #ff6aa5 7px 14px);
    box-shadow:inset 0 0 0 6px #ffb3cf, 0 0 36px rgba(0,0,0,.15);
    z-index:6;transition:transform 1050ms cubic-bezier(.22,.9,.22,1);
  }
  .curtain.left{left:0;transform:translateX(0)}
  .curtain.right{right:0;transform:translateX(0)}
  .frame.open .curtain.left{transform:translateX(-100%)}
  .frame.open .curtain.right{transform:translateX(100%)}

  .content{position:absolute; inset:0; display:grid; place-items:center; padding:18px}
  .panel{width:100%; max-width:960px; position:relative; z-index:5}
  h1,h2,p{margin:0}
  h1, h2{font-size:42px; letter-spacing:1px; text-shadow:0 2px 0 #fff8}

  /* Start card */
  .card{
    background: #fff6;
    border:4px solid #ffd3e6;
    border-radius:14px;
    padding:18px 22px;
    text-align:center;
    box-shadow:0 8px 0 #e6aac4;
    backdrop-filter: blur(1px);
  }
  .btn{
    cursor:pointer; margin-top:10px; padding:10px 18px;
    background:var(--white); border:3px solid #ffc2da; border-radius:10px;
    font-weight:700; box-shadow:0 4px 0 #e6aac4;
  }
  .btn:active{transform:translateY(2px); box-shadow:0 2px 0 #e6aac4}

  /* Player select */
  .players{display:flex; gap:20px; justify-content:center; flex-wrap:wrap; margin-top:14px}
  .player{
    width:220px; aspect-ratio:1/1.1; border-radius:14px; overflow:hidden;
    border:4px solid #ffd3e6; background:#fff; cursor:pointer;
    box-shadow:0 6px 0 #e6aac4; transition:transform .12s ease;
  }
  .player:hover{transform:translateY(-3px)}
  .player img{width:100%; height:100%; object-fit:cover; display:block}

  /* Choose destination */
  .top-title{
    position:absolute; left:0; right:0; top:34px; text-align:center;
    font-size:44px;
  }
  .grid{
    margin-top:120px;              /* pushes buttons toward center like you asked */
    display:grid; grid-template-columns:repeat(2, 1fr); gap:16px;
  }
  .option{
    padding:14px 16px; font-size:26px; text-align:center;
    background:#fff; border:4px solid #ffd3e6; border-radius:12px;
    box-shadow:0 5px 0 #e6aac4; cursor:pointer;
  }
  .option:active{transform:translateY(2px); box-shadow:0 3px 0 #e6aac4}

  /* Dialog bar with avatar */
  .dialog{
    position:absolute; left:16px; right:16px; bottom:16px; z-index:7;
    background:#b68aa5d0; border:3px solid #ffc3da; border-radius:12px;
    padding:10px 14px; display:flex; align-items:center; gap:10px;
    color:#fff; text-shadow:0 1px 0 #0006; font-size:24px;
  }
  .dialog img{width:36px; height:36px; object-fit:cover; border-radius:8px; border:2px solid #ffd3e6}

  /* Success: floating chosen player */
  .floatCard{
    position:absolute; left:50%; top:50%;
    width:220px; aspect-ratio:1/1.1; transform:translate(-50%,-50%);
    border-radius:14px; overflow:hidden; border:4px solid #ffd3e6; display:none;
    z-index:8; background:#fff; box-shadow:0 8px 30px rgba(0,0,0,.25);
  }

  /* FX canvas */
  canvas#fx{position:absolute; inset:0; z-index:7; pointer-events:none}

  /* helper */
  .hide{display:none}
</style>
</head>
<body>
  <div class="frame" id="frame">
    <canvas id="fx"></canvas>
    <div class="curtain left"></div>
    <div class="curtain right"></div>

    <div class="content" id="screen">

      <!-- START -->
      <div class="panel" id="startPane">
        <div class="card">
          <h1>Welcome</h1>
          <p>Click to start</p>
          <button class="btn" id="startBtn">Start</button>
        </div>
      </div>

      <!-- PLAYER SELECT -->
      <div class="panel hide" id="playerPane">
        <div class="card" style="max-width:720px;margin-inline:auto">
          <h2>Pick your player</h2>
          <div class="players">
            <button class="player" data-src="assets/player-profile.jpg" id="p1" title="PlayerProfile" style="display:none">
              <img src="assets/player-profile.jpg" alt="Player 1"
                   onload="this.parentElement.style.display='block'"
                   onerror="this.parentElement.remove()">
            </button>
            <button class="player" data-src="assets/player-profile-2.jpg" id="p2" title="PlayerProfile2" style="display:none">
              <img src="assets/player-profile-2.jpg" alt="Player 2"
                   onload="this.parentElement.style.display='block'"
                   onerror="this.parentElement.remove()">
            </button>
          </div>
        </div>
      </div>

      <!-- DESTINATION -->
      <div class="panel hide" id="quizPane">
        <div class="top-title">Choose your destination!</div>
        <div class="grid" style="max-width:720px;margin:0 auto;">
          <button class="option" data-key="IUB">IUB</button>
          <button class="option" data-key="NSU">NSU</button>
          <button class="option" data-key="AIUB">AIUB</button>
          <button class="option" data-key="BRAC">BRAC</button>
        </div>
      </div>

      <!-- Floating chosen player on success -->
      <div class="floatCard" id="floatCard"><img id="floatImg" src="" alt="" style="width:100%;height:100%;object-fit:cover"></div>
    </div>

    <div class="dialog" id="dialog">
      <img src="assets/avatar.jpg" alt="avatar">
      <div id="dialogText">BOO! Where do you want to go?</div>
    </div>
  </div>

<script>
/* ========== Utilities ========== */
const $ = s => document.querySelector(s);
const $$ = s => document.querySelectorAll(s);

/* Typewriter + backspace */
function typeText(el, text, speed=22){
  return new Promise(res=>{
    el.textContent = '';
    let i=0;
    const t = setInterval(()=>{
      el.textContent += text[i++];
      if(i>=text.length){clearInterval(t); res();}
    }, speed);
  });
}
function backspaceText(el, totalMs=3000){
  return new Promise(res=>{
    const full = el.textContent;
    const steps = full.length;
    const stepMs = Math.max(12, Math.floor(totalMs/steps));
    let i = steps;
    const t = setInterval(()=>{
      el.textContent = full.slice(0, --i);
      if(i<=0){clearInterval(t); res();}
    }, stepMs);
  });
}

/* Gentle center float (no rotation) */
let floatRAF, floatT=0;
function startFloat(el){
  cancelAnimationFrame(floatRAF);
  const rect = el.getBoundingClientRect();
  const baseX = window.innerWidth/2;
  const baseY = window.innerHeight/2;
  const amp = 24;               // small movement
  const spd = 0.0018;           // slower = gentler
  function loop(ts){
    floatT += spd*(ts||16);
    const dx = Math.sin(floatT*2)*amp;
    const dy = Math.cos(floatT*1.6)*amp;
    el.style.transform = `translate(calc(-50% + ${dx}px), calc(-50% + ${dy}px))`;
    floatRAF = requestAnimationFrame(loop);
  }
  loop();
}

/* Fireworks + confetti (simple) */
const Fx = (function(){
  const c = $('#fx'), ctx = c.getContext('2d');
  let W=0,H=0, parts=[], raf;
  function resize(){ W=c.width=c.offsetWidth; H=c.height=c.offsetHeight; }
  window.addEventListener('resize', resize); resize();

  function burst(x,y, color='#ffec00', count=100){
    for(let i=0;i<count;i++){
      const a=Math.random()*Math.PI*2, v=1+Math.random()*3;
      parts.push({x,y, vx:Math.cos(a)*v, vy:Math.sin(a)*v, life:60+Math.random()*40, age:0, color});
    }
    if(!raf) loop();
  }
  function confetti(x,y, count=30){
    for(let i=0;i<count;i++){
      const a=-Math.PI/2 + (Math.random()-0.5)*0.7, v=2+Math.random()*2;
      parts.push({x,y, vx:Math.cos(a)*v, vy:Math.sin(a)*v, life:70+Math.random()*30, age:0, color: i%2? '#ff79a8':'#fff' });
    }
    if(!raf) loop();
  }
  function loop(){
    raf=requestAnimationFrame(loop);
    ctx.clearRect(0,0,W,H);
    for(let i=parts.length-1;i>=0;i--){
      const p=parts[i];
      p.age++; p.x+=p.vx; p.y+=p.vy; p.vy+=0.03;
      const a=1-p.age/p.life;
      if(a<=0){ parts.splice(i,1); continue; }
      ctx.globalAlpha=a;
      ctx.fillStyle=p.color;
      ctx.fillRect(p.x, p.y, 3,3);
      ctx.globalAlpha=1;
    }
    if(parts.length===0){ cancelAnimationFrame(raf); raf=0; }
  }
  return {burst, confetti};
})();

/* ===== App flow ===== */
const frame = $('#frame');
const startPane = $('#startPane');
const playerPane = $('#playerPane');
const quizPane = $('#quizPane');
const dialog = $('#dialog');
const dialogText = $('#dialogText');
const floatCard = $('#floatCard');
const floatImg = $('#floatImg');

let chosenPlayerSrc = null;
let firstClicks = { IUB:false, NSU:false, AIUB:false, BRAC:false };

function showCurtains(){ frame.classList.remove('open'); }
function openCurtains(){ frame.classList.add('open'); }

/* Start → open curtains → player select */
$('#startBtn').addEventListener('click', async ()=>{
  // visible curtains are already present; opening them:
  openCurtains();
  startPane.classList.add('hide');
  playerPane.classList.remove('hide');
  await typeText(dialogText,"Pick your player.",20);
});

/* Pick player */
$$('.player').forEach(btn=>{
  btn.addEventListener('click', async ()=>{
    chosenPlayerSrc = btn.dataset.src;
    playerPane.classList.add('hide');
    quizPane.classList.remove('hide');
    await typeText(dialogText,"BOO! Where do you want to go?",20);
  });
});

/* Quiz logic */
const correctKey = 'IUB';
$$('.option').forEach(btn=>{
  btn.addEventListener('click', async ()=>{
    const key = btn.dataset.key;
    const first = !firstClicks[key]; firstClicks[key]=true;

    if(key !== correctKey){
      let msg="";
      if(key==='NSU') msg = first ? "You're too broke for this." : "Ah, you miss me that much.";
      if(key==='AIUB') msg = first ? "Don't go there." : "Whoa, whoa, whoa, don't go there now, come on.";
      if(key==='BRAC') msg = first ? "Whoa, I thought you were scared of presentations." : "Damn, I don't think you have the money for this.";
      await typeText(dialogText, msg, 20);
      return;
    }

    // Correct picked
    if(first){               // first IUB click
      await typeText(dialogText, "First attempt didn't work, try again!", 20);
      return;
    }

    // Success flow (second IUB)
    await typeText(dialogText, "Congratulations, this is the first step to your dreams.", 20);

    // floating chosen player
    if(chosenPlayerSrc){
      floatImg.src = chosenPlayerSrc;
      floatCard.style.display='block';
      startFloat(floatCard);
    }

    // Fireworks + confetti from bottom corners
    const rect = frame.getBoundingClientRect();
    Fx.burst(30, rect.height-30, '#ff79a8', 130);
    Fx.burst(rect.width-30, rect.height-30, '#ffd400', 130);
    Fx.confetti(rect.width/2, rect.height-40, 80);

    // Backspace after ~3s, then 2s later type "I love you"
    setTimeout(async ()=>{
      await backspaceText(dialogText, 3000);
      setTimeout(()=> typeText(dialogText, "I love you", 28), 2000);
    }, 3000);
  });
});

/* Init state: curtains closed, start screen visible */
showCurtains();

/* Safety: ensure canvas sizes correct on load */
window.addEventListener('load', ()=>window.dispatchEvent(new Event('resize')));
</script>
</body>
</html>
