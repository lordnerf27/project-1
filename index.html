<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>VibeCode – Retro App</title>
<link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
<style>
  *{box-sizing:border-box}
  html,body{height:100%;margin:0}

  :root{
    --bg: #f6dee6;             /* sakura pink */
    --panel: #ffeaf1;
    --panel-2:#ffd7e6;
    --ink:#1d1b20;
    --accent:#d46a8f;
    --shadow: rgba(0,0,0,.20);
    --green:#9bbc0f; /* fireworks dots */
  }

  body{
    font-family:"VT323",ui-monospace,monospace;
    color:var(--ink);
    background: var(--bg) url('assets/global_bg.jpg') top left / 900px repeat fixed; /* PINK global bg */
    display:grid; place-items:center;
  }

  /* Bigger frame */
  .frame{
    width:min(98vw, 1200px);
    aspect-ratio:16/9;
    position:relative;
    border:12px solid #fff;
    border-radius:22px;
    background: linear-gradient(180deg, var(--panel) 0%, var(--panel-2) 100%); /* PINK frame bg */
    box-shadow:
      0 30px 60px var(--shadow),
      inset 0 0 0 6px #ffd1e0,
      inset 0 0 0 14px #fff;
    overflow:hidden;
    image-rendering:pixelated;
  }

  /* Softer “drape” curtains (no candy stripes) */
  .curtain{
    position:absolute; top:0; bottom:0; width:56%;
    background:
      radial-gradient(120% 180% at 0% 50%, rgba(255,122,167,.25) 0 60%, transparent 60%),
      radial-gradient(120% 180% at 100% 50%, rgba(255,122,167,.25) 0 60%, transparent 60%),
      linear-gradient(180deg, #ffc1d4 0%, #ff9ab8 100%);
    filter: saturate(1.05);
    z-index:8;
    transform: translateX(0);
    transition: transform 1100ms cubic-bezier(.16,.84,.21,1.04);
    animation: sway 2.8s ease-in-out infinite;
  }
  .curtain.left  { left:0;  box-shadow: inset -10px 0 0 #ff7aa7, 0 10px 40px var(--shadow); }
  .curtain.right { right:0; box-shadow: inset  10px 0 0 #ff7aa7, 0 10px 40px var(--shadow); }

  @keyframes sway{
    0%,100%{ transform: translateX(0) translateY(0); }
    50%{ transform: translateX(0) translateY(-3px); }
  }

  .curtains-open .curtain.left  { transform: translateX(-100%); animation:none; }
  .curtains-open .curtain.right { transform: translateX(100%);  animation:none; }

  /* Start message on top of curtains */
  .start-overlay{
    position:absolute; inset:0; display:grid; place-items:center; z-index:9;
  }
  .start-msg{
    background:#fff; border:4px solid #ffd1e0; border-radius:14px;
    padding:12px 16px; box-shadow:0 10px 0 #ffb6cf;
    font-size:42px; cursor:pointer;
  }

  /* Layers */
  .layer{position:absolute; inset:0; display:grid; place-items:center; padding:24px}
  .hidden{display:none}

  /* Cards / buttons */
  .card{
    background:#fff; border:4px solid #ffd1e0; border-radius:16px;
    box-shadow:0 10px 0 #ffb6cf, 0 20px 40px var(--shadow);
    padding:20px 24px; text-align:center; max-width:640px;
  }
  h1,h2,p{margin:.25rem 0}
  .btn{
    cursor:pointer; display:inline-block; margin-top:10px;
    padding:10px 18px; border:3px solid #ffb6cf; background:#ffebf2;
    box-shadow:0 4px 0 #ffb6cf; text-transform:uppercase; letter-spacing:1px; font-weight:700;
  }
  .btn:active{ transform: translateY(2px); box-shadow:0 2px 0 #ffb6cf }

  /* Player select */
  .player-card{
    width:min(45%, 420px); /* ~¾ of the old feel */
    cursor:pointer;
    border:4px solid #ffb6cf; border-radius:14px; overflow:hidden; background:#fff;
    box-shadow:0 10px 0 #ffb6cf, 0 20px 40px var(--shadow);
    transition: transform .12s ease, box-shadow .12s ease;
    margin:auto;  /* centered */
  }
  .player-card:hover{ transform: translateY(-2px); box-shadow:0 12px 0 #ffb6cf, 0 24px 44px var(--shadow) }
  .player-card img{ width:100%; display:block; }

  /* Choice grid */
  .panel{ width:100%; max-width:820px; align-self:start; margin-top:18px; }
  .panel h2{ text-align:center; font-size:40px; margin:0 0 8px 0; }
  .grid{ display:grid; grid-template-columns: repeat(2, 1fr); gap:14px; margin-top:14px }
  .option{
    padding:16px 12px; border:3px solid #ffb6cf; background:#fff; text-align:center; font-weight:700;
    box-shadow:0 4px 0 #ffb6cf; cursor:pointer;
  }
  .option:active{ transform: translateY(2px); box-shadow:0 2px 0 #ffb6cf }

  /* Dialog box (bottom) */
  .dialog{
    position:absolute; left:16px; right:16px; bottom:16px;
    display:flex; gap:10px; align-items:flex-start;
    padding:10px 12px; background: rgba(0,0,0,.25);
    border:3px solid #ffb6cf; border-radius:12px; color:#fff; font-size:22px;
    z-index:6;
  }
  .avatar{
    width:42px; height:42px; border-radius:8px; border:3px solid #ffb6cf; overflow:hidden; flex:0 0 auto; background:#fff;
  }
  .avatar img{width:100%;height:100%;object-fit:cover}

  /* FX canvas */
  canvas#fx{ position:absolute; inset:0; pointer-events:none; z-index:5 }

  /* Celebration card (post-success) */
  .celebrate{
    position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
    width:min(38%, 360px); border:4px solid #ffb6cf; border-radius:14px; overflow:hidden; background:#fff;
    box-shadow:0 10px 0 #ffb6cf, 0 20px 40px var(--shadow);
  }
</style>
</head>
<body>
  <div class="frame" id="frame">
    <canvas id="fx"></canvas>

    <!-- Curtains & start message -->
    <div class="curtain left"></div>
    <div class="curtain right"></div>
    <div class="start-overlay" id="startOverlay">
      <div class="start-msg" id="startMsg">Click to start</div>
    </div>

    <!-- Player Select -->
    <div class="layer hidden" id="playerLayer">
      <div class="card" style="background:transparent; box-shadow:none; border:none">
        <h2 style="font-size:36px; text-align:center; margin-bottom:10px;">Pick your player</h2>
        <div class="player-card" id="playerCard" title="Click to select">
          <img src="assets/player-profile.jpg" alt="Player profile">
        </div>
      </div>
    </div>

    <!-- Choices -->
    <div class="layer hidden" id="choiceLayer">
      <div class="panel">
        <h2>Choose your destination!</h2>
        <div class="grid">
          <button class="option" data-key="B">IUB</button>
          <button class="option" data-key="A">NSU</button>
          <button class="option" data-key="C">AIUB</button>
          <button class="option" data-key="D">BRAC</button>
        </div>
      </div>
      <div class="dialog" id="dialog">
        <div class="avatar"><img src="assets/admin-avatar.jpg" alt="Admin"></div>
        <div id="dialogText"></div>
      </div>
    </div>
  </div>

<script>
/* ===== tiny sfx (beeps) ===== */
const SFX = (() => {
  let ctx;
  const ensure = () => ctx = ctx || new (window.AudioContext||window.webkitAudioContext)();
  const beep = (f=520,d=0.12,t='square',v=0.12) => {
    ensure();
    const o = ctx.createOscillator(), g = ctx.createGain();
    o.type=t; o.frequency.value=f; g.gain.value=v; o.connect(g); g.connect(ctx.destination);
    const now = ctx.currentTime; o.start(now); o.stop(now+d);
  };
  return { beep };
})();

/* ===== fireworks + confetti ===== */
const FX = (() => {
  const c = document.getElementById('fx'), k = c.getContext('2d');
  let W,H, raf, parts=[];
  const R = (a,b)=>a+Math.random()*(b-a);
  const resize = () => { W=c.width=c.offsetWidth; H=c.height=c.offsetHeight; };
  window.addEventListener('resize', resize); resize();

  function burst(x,y,n=110, color='#9bbc0f'){
    for(let i=0;i<n;i++){
      const a=Math.random()*Math.PI*2, s=R(1.6,3.8);
      parts.push({t:'fw',x,y,vx:Math.cos(a)*s,vy:Math.sin(a)*s,life:R(40,80),age:0,color});
    }
    loop();
  }

  const confCols=['#ff6b6b','#ffd166','#8ecae6','#bde0fe','#caffbf','#ffc8dd','#a0c4ff'];
  function popper(x,y,dir=1,count=90){
    for(let i=0;i<count;i++){
      const sp=R(2.2,4.4), ang=R(-Math.PI*0.85,-Math.PI*0.15);
      parts.push({
        t:'cf', x, y,
        vx: Math.cos(ang)*sp*dir, vy: Math.sin(ang)*sp,
        w:R(2,5), h:R(6,12), rot:R(0,Math.PI), vr:R(-0.2,0.2),
        life:R(120,200), age:0, color: confCols[(Math.random()*confCols.length)|0]
      });
    }
    loop();
  }

  function loop(){
    if(raf) return;
    raf = requestAnimationFrame(function draw(){
      k.clearRect(0,0,W,H);
      for(let i=parts.length-1;i>=0;i--){
        const p=parts[i]; p.age++;
        if(p.t==='fw'){
          p.x+=p.vx; p.y+=p.vy; p.vy+=0.02;
          const a=1-p.age/p.life; if(a<=0){ parts.splice(i,1); continue; }
          k.globalAlpha=a; k.fillStyle=p.color; k.fillRect(p.x,p.y,3,3); k.globalAlpha=1;
        }else{ // confetti
          p.x+=p.vx; p.y+=p.vy; p.vy+=0.03; p.rot+=p.vr;
          const a=1-p.age/p.life; if(a<=0 || p.y>H+20){ parts.splice(i,1); continue; }
          k.save(); k.translate(p.x,p.y); k.rotate(p.rot); k.globalAlpha=a;
          k.fillStyle=p.color; k.fillRect(-p.w/2,-p.h/2,p.w,p.h);
          k.restore(); k.globalAlpha=1;
        }
      }
      if(parts.length){ raf=requestAnimationFrame(draw); } else { raf=null; }
    });
  }

  return { burst, popper };
})();

/* ===== typewriter text ===== */
function typeText(el, text, speed=22, cb){
  el.textContent='';
  let i=0; const id=setInterval(()=>{
    el.textContent += text[i++]||'';
    if(i>text.length){ clearInterval(id); cb && cb(); }
  }, speed);
}

/* ===== flow ===== */
const frame        = document.getElementById('frame');
const startOverlay = document.getElementById('startOverlay');
const startMsg     = document.getElementById('startMsg');
const playerLayer  = document.getElementById('playerLayer');
const choiceLayer  = document.getElementById('choiceLayer');
const dialogText   = document.getElementById('dialogText');

startMsg.addEventListener('click', firstStart, { once:true });

function firstStart(){
  startOverlay.style.display = 'none';
  frame.classList.add('curtains-open');
  SFX.beep(640,.12);
  playerLayer.classList.remove('hidden');
  typeText(dialogText, "Pick your player.");
}

/* Pick player -> Choices + dialog text changes */
document.getElementById('playerCard').addEventListener('click', ()=>{
  SFX.beep(740,.14);
  playerLayer.classList.add('hidden');
  choiceLayer.classList.remove('hidden');
  typeText(dialogText, "BOO! Where do you want to go?");
});

/* Destination logic */
let correctKey='B';
let firstHit=false;

document.querySelectorAll('.option').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const key = btn.dataset.key;
    if(key!==correctKey){
      SFX.beep(180,.10);
      const wrong = {
        A:"you're too broke for this.",
        C:"whoops, not this one.",
        D:"whoa, you're not going here—too far!"
      }[key] || "Nope.";
      typeText(dialogText, wrong);
      return;
    }
    if(!firstHit){
      firstHit=true;
      typeText(dialogText, "First attempt didn’t work. Try again!");
      SFX.beep(360,.12);
      return;
    }

    // Success
    typeText(dialogText, "Congratulations! This is the first step to your dreams!", 22, ()=>{
      setTimeout(showCelebration, 500); // after text finishes + 0.5s
    });
    SFX.beep(620,.12);

    // Fireworks from bottom corners + poppers
    const fr = frame.getBoundingClientRect();
    const leftX  = 30, rightX = fr.width-30, bottomY = fr.height-30;
    for(let i=0;i<4;i++){
      setTimeout(()=>FX.burst(leftX,  bottomY, 120, '#9bbc0f'), i*120);
      setTimeout(()=>FX.burst(rightX, bottomY, 120, '#9bbc0f'), i*120);
    }
    FX.popper(40, bottomY-5, +1, 120);          // left-to-right
    FX.popper(fr.width-40, bottomY-5, -1, 120); // right-to-left
  });
});

/* Celebration: bring back player card as bouncing overlay */
function showCelebration(){
  const card = document.createElement('div');
  card.className='celebrate';
  card.innerHTML = `<img src="assets/player-profile.jpg" alt="Player" style="width:100%;display:block;">`;
  frame.appendChild(card);

  // simple pinball-ish bounce inside a centered box
  const bounds = { 
    x: frame.clientWidth*0.35, y: frame.clientHeight*0.25,
    w: frame.clientWidth*0.30,  h: frame.clientHeight*0.35
  };
  let x = bounds.x + bounds.w/2, y = bounds.y + bounds.h/2;
  let vx = (Math.random()<.5?-1:1)*1.2, vy = -1.1;

  function tick(){
    x+=vx; y+=vy;
    if(x<bounds.x || x>bounds.x+bounds.w) vx*=-1;
    if(y<bounds.y || y>bounds.y+bounds.h) vy*=-1;
    card.style.left = x+'px'; card.style.top = y+'px';
    card.style.transform = 'translate(-50%,-50%) rotate('+(x+y)/40+'deg)';
    requestAnimationFrame(tick);
  }
  tick();
}
</script>
</body>
</html>
