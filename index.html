<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VibeCode Retro App</title>
  <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; }

    :root {
      /* Sakura-cream theme */
      --bg-top:  #fde6ef;
      --bg-deep: #f9d8e6;
      --cream:   #ffe9f1;
      --cream-2: #fff6fa;
      --text:    #2a1a22;
      --shadow:  rgba(0,0,0,0.18);
      --accent:  #d69db3;
    }

    body {
      background: var(--bg-deep);
      display: grid; place-items: center;
      font-family: 'VT323', ui-monospace, monospace;
      color: var(--text);
      letter-spacing: 0.3px;
    }

    .frame {
      width: min(98vw, 1280px);
      aspect-ratio: 16/9;
      border: 12px solid var(--cream-2);
      border-radius: 20px;
      box-shadow: 0 18px 50px var(--shadow), inset 0 0 0 6px var(--accent);
      position: relative;
      image-rendering: pixelated;
      overflow: hidden;
      background: linear-gradient(180deg, var(--bg-top) 0%, var(--bg-deep) 100%);
    }

    /* Layers */
    .content { position: absolute; inset: 0; display: grid; place-items: center; padding: clamp(16px, 2vw, 32px); z-index: 9; }
    canvas#fx { position: absolute; inset: 0; pointer-events: none; z-index: 4; }

    /* Background scene layer (for decorative images/GIFs/text) */
    .bg { position: absolute; inset: 0; z-index: 3; pointer-events: none; }
    .bg .deco { position: absolute; transform: translate(-50%, -50%); image-rendering: pixelated; }
    .bg .deco.text {
      color: var(--text); font-weight: 700; background: rgba(255,255,255,0.35);
      border: 2px solid var(--cream-2); padding: 4px 8px; border-radius: 8px;
    }
    @keyframes float { 0%{ transform: translate(-50%,-50%) translateY(0);} 50%{ transform: translate(-50%,-50%) translateY(-8px);} 100%{ transform: translate(-50%,-50%) translateY(0);} }
    @keyframes drift { 0%{ transform: translate(-50%,-50%) translateX(0);} 50%{ transform: translate(-50%,-50%) translateX(10px);} 100%{ transform: translate(-50%,-50%) translateX(0);} }
    @keyframes spin  { 0%{ transform: translate(-50%,-50%) rotate(0deg);} 100%{ transform: translate(-50%,-50%) rotate(360deg);} }
    .anim-float{ animation: float 4s ease-in-out infinite; }
    .anim-drift{ animation: drift 8s ease-in-out infinite; }
    .anim-spin { animation: spin  12s linear infinite; }

    /* Welcome card (always on top) */
    .card {
      background: var(--cream);
      border: 4px solid var(--cream-2);
      border-radius: 16px;
      padding: clamp(20px, 3vw, 40px) clamp(24px, 3.2vw, 48px);
      text-align: center;
      box-shadow: 0 8px 0 rgba(0,0,0,0.18);
      position: relative;
      z-index: 12;
    }
    .card h1 { font-size: clamp(28px, 5vw, 64px); margin: 0 0 8px; }
    .card p  { font-size: clamp(18px, 2.4vw, 32px); margin: 0 0 10px; }

    .btn {
      cursor: pointer; display: inline-block; margin-top: 12px;
      padding: clamp(10px, 1.6vw, 18px) clamp(18px, 2.6vw, 28px);
      border: 3px solid var(--cream-2);
      background: var(--cream-2); color: var(--text); font-weight: 700;
      box-shadow: 0 4px 0 rgba(0,0,0,0.2); text-transform: uppercase; letter-spacing: 1px;
      font-size: clamp(16px, 2.2vw, 28px);
    }
    .btn:active { transform: translateY(2px); box-shadow: 0 2px 0 rgba(0,0,0,0.2); }

    /* Curtains: smoother “fluid” open */
    .curtain {
      position: absolute; top: 0; bottom: 0; width: 55%;
      z-index: 5;
      transition: transform 900ms cubic-bezier(.2,.8,.2,1), filter 900ms ease;
      background:
        linear-gradient(180deg, rgba(255,255,255,0.25), rgba(0,0,0,0.05)),
        repeating-linear-gradient(90deg, #f8c7d8 0 12px, #efb7cb 12px 24px);
      box-shadow: inset 0 0 0 2px var(--accent);
      will-change: transform; filter: drop-shadow(0 8px 10px rgba(0,0,0,0.12));
    }
    .curtain.left  { left: 0;  transform: translateX(0) skewX(0deg);  box-shadow: inset -10px 0 0 rgba(0,0,0,0.12); }
    .curtain.right { right: 0; transform: translateX(0) skewX(0deg);  box-shadow: inset  10px 0 0 rgba(0,0,0,0.12); }
    .curtains-open .curtain.left  { transform: translateX(-100%) skewX(-1.5deg); }
    .curtains-open .curtain.right { transform: translateX(100%)  skewX( 1.5deg); }
    @keyframes ripple { 0%{ transform: translateX(0) skewX(0deg);} 50%{ transform: translateX(0) skewX(1.5deg);} 100%{ transform: translateX(0) skewX(0deg);} }
    .wavy { animation: ripple 700ms ease; }

    /* Pixel character slots */
    .char {
      position: absolute; bottom: 18px; width: clamp(48px, 6vw, 88px); height: clamp(48px, 6vw, 88px);
      background: var(--cream-2); border: 4px solid var(--cream-2);
      box-shadow: 0 3px 0 rgba(0,0,0,0.2); z-index: 6;
      image-rendering: pixelated; background-size: contain; background-repeat: no-repeat; background-position: center bottom;
    }
    .char-left  { left: 14px;  background-image: url('assets/levi.png'); }
    .char-right { right: 14px; background-image: url('assets/inosuke.png'); }
    @keyframes pull { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-3px); } }
    .pulling { animation: pull 600ms steps(3) infinite; }

    /* Choices */
    .panel { width: 100%; max-width: 1040px; }
    h1, h2, p { margin: 0 0 8px 0; }
    .title { text-align: center; font-size: clamp(28px, 4.2vw, 64px); margin-top: clamp(6px, 1.2vw, 12px); }
    .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: clamp(12px, 2vw, 24px); margin-top: clamp(12px, 2vw, 20px); }
    .option {
      padding: clamp(16px, 2.2vw, 28px) clamp(12px, 1.6vw, 18px);
      border: 3px solid var(--cream-2); background: var(--cream); color: var(--text);
      text-align: center; font-weight: 700; cursor: pointer; box-shadow: 0 4px 0 rgba(0,0,0,0.2);
      font-size: clamp(18px, 2.4vw, 32px);
    }
    .option:active { transform: translateY(2px); box-shadow: 0 2px 0 rgba(0,0,0,0.2); }

    /* Status bar (we use this for all messages during play) */
    .status {
      position: absolute; left: 12px; right: 12px; bottom: 12px;
      padding: clamp(8px, 1.2vw, 14px) clamp(10px, 1.6vw, 18px);
      background: rgba(42, 26, 34, 0.66);
      border: 2px solid var(--cream-2); border-radius: 10px;
      font-size: clamp(16px, 2.2vw, 24px); color: #fff; font-weight: 600;
      z-index: 8;
    }

    /* Success dialog */
    .dialog { position: absolute; inset: 0; display: grid; place-items: center; z-index: 13; }
    .dialog .box {
      background: var(--cream); border: 4px solid var(--cream-2); border-radius: 14px;
      box-shadow: 0 10px 0 rgba(0,0,0,0.2); padding: clamp(18px, 2.4vw, 32px) clamp(22px, 3vw, 44px);
      text-align: center; max-width: 720px; width: 90%;
    }
    .dialog h3 { font-size: clamp(26px, 3.8vw, 48px); margin: 0 0 6px; }
    .dialog p  { font-size: clamp(18px, 2.4vw, 28px); margin: 0; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="frame" id="frame">
    <canvas id="fx"></canvas>

    <!-- Background items layer -->
    <div class="bg" id="bg"></div>

    <!-- Curtains + characters -->
    <div class="curtain left"></div>
    <div class="curtain right"></div>
    <div class="char char-left pulling"></div>
    <div class="char char-right pulling"></div>

    <div class="content" id="screen">
      <!-- Welcome Screen -->
      <div class="card" id="welcome">
        <h1>Welcome</h1>
        <p>Press <strong>Start</strong> to begin</p>
        <button class="btn" id="startBtn">Start</button>
      </div>

      <!-- Choice Screen -->
      <div class="panel" id="choices" style="display:none">
        <h2 class="title">Choose your destination!</h2>
        <div class="grid">
          <button class="option" data-key="A">NSU</button>
          <button class="option" data-key="B">IUB</button>
          <button class="option" data-key="C">AIUB</button>
          <button class="option" data-key="D">BRAC</button>
        </div>
      </div>
    </div>

    <div class="status" id="status">Press Start to begin.</div>

    <!-- Success dialog -->
    <div class="dialog hidden" id="congrats">
      <div class="box">
        <h3>Congratulations</h3>
        <p>This is the first step to your dreams.</p>
      </div>
    </div>
  </div>

  <script>
    /* Audio */
    const Audio = (() => {
      let ctx;
      const ensure = () => { ctx = ctx || new (window.AudioContext || window.webkitAudioContext)(); return ctx; };
      const beep = (freq=220, dur=0.12, type='square', vol=0.15) => {
        const c = ensure(); const o = c.createOscillator(); const g = c.createGain();
        o.type = type; o.frequency.value = freq; g.gain.value = vol;
        o.connect(g); g.connect(c.destination);
        const now = c.currentTime; o.start(now); o.stop(now + dur);
      };
      const melody = (notes=[{f:523,d:0.14},{f:659,d:0.14},{f:784,d:0.18},{f:1046,d:0.24}], gap=0.04) => {
        const c = ensure(); let t = c.currentTime;
        notes.forEach(n => { const o=c.createOscillator(), g=c.createGain();
          o.type='square'; o.frequency.value=n.f; g.gain.value=0.12; o.connect(g); g.connect(c.destination);
          o.start(t); o.stop(t+n.d); t += n.d + gap;
        });
      };
      return { beep, melody };
    })();

    /* FX: fireworks + confetti */
    const FX = (() => {
      const c = document.getElementById('fx');
      const ctx = c.getContext('2d');
      let W,H, raf, particles=[];
      const rnd=(a,b)=>a+Math.random()*(b-a);
      const colors = ['#ffecf7','#ffe3ef','#f9d8e6','#ffd1e8','#ffffff','#eac6d3','#f7dfe8'];
      const resize = () => { W = c.width = c.offsetWidth; H = c.height = c.offsetHeight; };

      const burst = (x,y,count=90) => {
        for(let i=0;i<count;i++){
          const ang=Math.random()*Math.PI*2, spd=rnd(1.2,3.4);
          particles.push({ type:'spark', x, y, vx: Math.cos(ang)*spd, vy: Math.sin(ang)*spd, life:rnd(40,80), age:0, col:'#e979a8' });
        }
        if(!raf) loop();
      };

      const confetti = (x,y,count=120,spread=Math.PI/3,up=true) => {
        const base = up ? -Math.PI/2 : Math.PI/2;
        for(let i=0;i<count;i++){
          const ang = base + rnd(-spread, spread);
          const spd = rnd(2.0, 5.0);
          const size = rnd(2,4);
          particles.push({ type:'confetti', x, y, vx: Math.cos(ang)*spd, vy: Math.sin(ang)*spd, rot:rnd(0,Math.PI*2), rs:rnd(-0.2,0.2), w:size, h:size*2, life:rnd(80,140), age:0, col: colors[(Math.random()*colors.length)|0] });
        }
        if(!raf) loop();
      };

      const loop = () => {
        raf = requestAnimationFrame(loop);
        ctx.clearRect(0,0,W,H);
        for(let i=particles.length-1;i>=0;i--){
          const p=particles[i]; p.age++;
          p.x+=p.vx; p.y+=p.vy; p.vy += 0.02;
          const a=1-p.age/p.life; if(a<=0){ particles.splice(i,1); continue; }
          ctx.globalAlpha=a;
          if(p.type==='spark'){
            ctx.fillStyle = '#e979a8';
            ctx.fillRect(p.x,p.y,3,3);
          } else {
            ctx.save(); ctx.translate(p.x,p.y); p.rot += p.rs; ctx.rotate(p.rot);
            ctx.fillStyle = p.col; ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h);
            ctx.restore();
          }
          ctx.globalAlpha=1;
        }
        if(particles.length===0){ cancelAnimationFrame(raf); raf=null; }
      };
      window.addEventListener('resize', resize); resize();
      return { burst, confetti };
    })();

    /* Simple background API */
    const bg = document.getElementById('bg');
    const VibeApp = window.VibeApp || (window.VibeApp = {});
    VibeApp.addBackgroundItems = (items=[])=>{
      if(!bg) return;
      items.forEach(it=>{
        if(it.type==='img'){
          const img=document.createElement('img'); img.src=it.src; img.alt=it.alt||'';
          img.className=`deco ${it.anim?('anim-'+it.anim):''}`;
          img.style.left=(it.x||50)+'%'; img.style.top=(it.y||50)+'%';
          img.style.width=(it.w||80)+'px'; img.style.height=(it.h||80)+'px';
          img.loading='lazy'; bg.appendChild(img);
        } else if(it.type==='text'){
          // Keep lyrics <= 10 words to avoid copyright issues.
          const t=document.createElement('div'); t.className='deco text'; t.textContent=it.text||'';
          t.style.left=(it.x||50)+'%'; t.style.top=(it.y||50)+'%';
          bg.appendChild(t);
        }
      });
    };

    /* App state */
    const frame    = document.getElementById('frame');
    const startBtn = document.getElementById('startBtn');
    const welcome  = document.getElementById('welcome');
    const choices  = document.getElementById('choices');
    const status   = document.getElementById('status');
    const dialog   = document.getElementById('congrats');

    const correctLabel = 'IUB';
    const incorrectMap = { 'NSU':'too broke', 'AIUB':'ahahahahha loser', 'BRAC':'too anxious' };

    let labelByKey = { A:'NSU', B:'IUB', C:'AIUB', D:'BRAC' };
    let correctKey = 'B';
    let correctClickedOnce = false;

    const shuffle = arr => arr.map(v=>({r:Math.random(),v})).sort((a,b)=>a.r-b.r).map(x=>x.v);

    function setupOptions(){
      const keys = ['A','B','C','D'];
      const labels = shuffle(['NSU','IUB','AIUB','BRAC']);
      const nodes = Array.from(document.querySelectorAll('.option'));
      labelByKey = {};
      nodes.forEach((n,i)=>{ const key=keys[i], label=labels[i]; n.dataset.key=key; n.textContent=label; labelByKey[key]=label; });
      correctKey = keys.find(k => labelByKey[k] === correctLabel) || 'B';
      correctClickedOnce = false;
      status.textContent = 'Pick the correct destination.';
    }

    const openCurtains = () => {
      frame.classList.add('curtains-open');
      document.querySelectorAll('.curtain').forEach(el=>el.classList.add('wavy'));
      setTimeout(()=>document.querySelectorAll('.curtain').forEach(el=>el.classList.remove('wavy')), 750);
      document.querySelectorAll('.char').forEach(el=>el.classList.remove('pulling'));
    };

    startBtn.addEventListener('click', () => {
      openCurtains();
      welcome.style.display = 'none';
      choices.style.display = 'block';
      setupOptions();
      Audio.beep(440, 0.1);

      // Example decorations (uncomment after you upload files into /assets)
      /*
      VibeApp.addBackgroundItems([
        {type:'img', src:'assets/ball27.png',   x:14, y:70, w:72, h:72, anim:'float', alt:'27'},
        {type:'img', src:'assets/wave.gif',     x:86, y:82, w:96, h:64, anim:'drift', alt:'wave'},
        {type:'img', src:'assets/headbang.gif', x:88, y:28, w:80, h:80, anim:'float', alt:'headbang'},
        {type:'text', text:'first step', x:50, y:18}  // <= 10 words
      ]);
      */
    });

    document.querySelectorAll('.option').forEach(btn => {
      btn.addEventListener('click', () => {
        const key = btn.dataset.key;
        const label = labelByKey[key];
        if(label !== correctLabel){
          status.textContent = incorrectMap[label] || 'Incorrect choice. This is not the university you chose.';
          Audio.beep(160, 0.12, 'square', 0.18);
          return;
        }
        if(!correctClickedOnce){
          correctClickedOnce = true;
          status.textContent = "First attempt didn't work. Try again!";
          Audio.beep(360, 0.12);
          return;
        }
        // Success: fireworks + two party poppers + dialog (no extra status text)
        const r = btn.getBoundingClientRect(), fr = frame.getBoundingClientRect();
        const x = r.left - fr.left + r.width/2, y = r.top - fr.top + r.height/2;
        for(let i=0;i<5;i++) setTimeout(()=>FX.burst(x, y), i*120);
        FX.confetti(40, fr.height-60, 140, Math.PI/4, true);
        FX.confetti(fr.width-40, fr.height-60, 140, Math.PI/4, true);
        Audio.melody();
        dialog.classList.remove('hidden');
      });
    });
  </script>
</body>
</html>
